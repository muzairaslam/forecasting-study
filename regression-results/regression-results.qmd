---
title: "Regression Analysis"
format: html
---

```{r}
library("tidyverse")
library("fpp3")
library("here")
library("gt")
library("gtsummary")
options(scipen = 10)  # Temporarily increase penalty for scientific notation
```

```{r}
data <- read_csv(here("data/data-consolidated-2.csv"))
```


```{r}
# Year = Index
data_arranged <- data |>
    rename(
        no = `Serial No`,
        fis_yr = `Fiscal Year`,
        nit_vol_k_ton = `Nitrogen Volume (N K tonnes)`,
        nit_price_per_ton = `Nitrogen Price (per tonne)`,
        water_maf = `Water Availability (MAF)`,
        cr_area_mn_hec = `Cropped Area (million hectares)`,
        agric_gdp_rs_bn = `Agricultural GDP (Rs in billions)`,
        agric_gdp_usd_bn_cy = `Agricultural GDP (current BN US$) C-Y`,
        credit_dis_rs_mn = `Total Credit Disbursed (Rs million)`,
        inp_out_ratio = `Input Output Ratio`,
        n_p_ratio = `N / P`,
        agric_employment = `Agriculture Employment (Mns)`,
        pkr_per_usd = `PKR-USD`
    ) |>
    mutate(
        lag_agric_gdp_usd_bn_cy = lag(agric_gdp_usd_bn_cy),
        tech_proxy = (agric_gdp_rs_bn/cr_area_mn_hec)/(cr_area_mn_hec/agric_employment),
        lg_nit_vol_k_ton = log(nit_vol_k_ton),
        lg_nit_price_per_ton = log(nit_price_per_ton),
        lg_water_maf = log(water_maf),
        lg_cr_area_mn_hec = log(cr_area_mn_hec),
        lg_agric_gdp_rs_bn = log(agric_gdp_rs_bn),
        lg_agric_gdp_usd_bn_cy = log(agric_gdp_usd_bn_cy),  
        lag_lg_agric_gdp_usd_bn_cy = log(lag_agric_gdp_usd_bn_cy),
        lg_credit_dis_rs_mn = log(credit_dis_rs_mn),
        lg_inp_out_ratio = log(inp_out_ratio),
        lg_n_p_ratio = log(inp_out_ratio),
        lg_tech_proxy = log(tech_proxy)
    ) |> 
    slice_tail(n = 29)

data_arranged$fis_yr <- as.integer(data_arranged$fis_yr)
data_arranged$no <- as.integer(data_arranged$no)
data_arranged$nit_vol_k_ton <- as.integer(data_arranged$nit_vol_k_ton)

data_tsibble <- data_arranged |> 
    as_tsibble(index = fis_yr)
```


```{r}
med_price_nit <- median(data_tsibble$nit_price_per_ton)
std_price_nit <- sd(data_tsibble$nit_price_per_ton)

med_vol_nit <- median(data_tsibble$nit_vol_k_ton)
std_vol_nit <- sd(data_tsibble$nit_vol_k_ton)

med_water_maf <- median(data_tsibble$water_maf)
std_water_maf <- sd(data_tsibble$water_maf)

med_cr_area_mn_hec <- median(data_tsibble$cr_area_mn_hec)
std_cr_area_mn_hec <- sd(data_tsibble$cr_area_mn_hec)

med_lag_agric_gdp <- median(data_tsibble$lag_agric_gdp_usd_bn_cy)
std_lag_agric_gdp <- sd(data_tsibble$lag_agric_gdp_usd_bn_cy)

med_credit_dis <- median(data_tsibble$credit_dis_rs_mn)
std_credit_dis <- sd(data_tsibble$credit_dis_rs_mn)

med_tech_proxy <- median(data_tsibble$tech_proxy)
std_tech_proxy <- sd(data_tsibble$tech_proxy)

med_np_ratio <- median(data_tsibble$n_p_ratio)
std_np_ratio <- sd(data_tsibble$n_p_ratio)

med_input_output_ratio <- median(data_tsibble$inp_out_ratio)
std_input_output_ratio <- sd(data_tsibble$inp_out_ratio)


# Combine the results into a data frame
summary_stats <- data.frame(
  variable = c(
    "nit_price_per_ton", "nit_vol_k_ton", "water_maf", "cr_area_mn_hec",
    "lag_agric_gdp_usd_bn_cy", "credit_dis_rs_mn", "tech_proxy", "np_ratio",
    "input_output_ratio"
  ),
  median = c(
    med_price_nit, med_vol_nit, med_water_maf, med_cr_area_mn_hec,
    med_lag_agric_gdp, med_credit_dis, med_tech_proxy, med_np_ratio,
    med_input_output_ratio
  ),
  std_dev = c(
    std_price_nit, std_vol_nit, std_water_maf, std_cr_area_mn_hec,
    std_lag_agric_gdp, std_credit_dis, std_tech_proxy, std_np_ratio,
    std_input_output_ratio
  )
)

```
### Variables

y = Nitrogen Consumption

x1 = Price of Nitrogen
x2 = Water Avaialability
x3 = Cropped Accreage
x4 = Lag Agric GDP Bn USD
x5 = Agric Credit
x6 = Tech Proxy
x7 = Input Output Ratio
x8 = N/P Ratio

### 6 Vars Model

```{r}
six_vars_model <- lm(
    nit_vol_k_ton ~ nit_price_per_ton + 
                    water_maf + 
                    cr_area_mn_hec +
                    lag_agric_gdp_usd_bn_cy +
                    credit_dis_rs_mn +
                    tech_proxy,
                    data = data_tsibble
        )
summary(six_vars_model)        
```

### 6 Vars Log Model

```{r}
six_vars_log_model <- lm(
    lg_nit_vol_k_ton ~ lg_nit_price_per_ton + 
                        lg_water_maf +
                        lg_cr_area_mn_hec + 
                        lag_lg_agric_gdp_usd_bn_cy + 
                        lg_credit_dis_rs_mn +
                        lg_tech_proxy,
                        data = data_tsibble
    )
```

### 8 Vars Model

```{r}
eight_vars_model <- lm(
    nit_vol_k_ton ~ nit_price_per_ton + 
                    water_maf + 
                    cr_area_mn_hec +
                    lag_agric_gdp_usd_bn_cy +
                    credit_dis_rs_mn +
                    tech_proxy +
                    inp_out_ratio +
                    n_p_ratio,
                    data = data_tsibble
        )
```

### 8 Vars Log Model


```{r}
eight_vars_log_model <- lm(
    lg_nit_vol_k_ton ~ lg_nit_price_per_ton + 
                        lg_water_maf +
                        lg_cr_area_mn_hec + 
                        lag_lg_agric_gdp_usd_bn_cy + 
                        lg_credit_dis_rs_mn +
                        lg_tech_proxy +
                        lg_inp_out_ratio +
                        lg_n_p_ratio,
                        data = data_tsibble
    )
```
